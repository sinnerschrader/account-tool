language: java
# install openjdk 8 manually since travis currently has no support for it
#jdk:
#  - openjdk8

cache:
  directories:
    - $HOME/.m2/repository/
    - node_modules

notifications:
  email:
    on_success: never

dist: xenial
sudo: required

before_install:
  - export NODE_VERSION="7.4.0"
  - export DEBIAN_FRONTEND="noninteractive"

install:
  - nvm install $NODE_VERSION
  - gem install package_cloud

before_script:
  - export MAVEN_OPTS="-Xmx256m"
  - nvm use $NODE_VERSION

script:
  - ./mvnw --batch-mode -s .settings.xml clean
  - ./mvnw --batch-mode -s .settings.xml -P security org.owasp:dependency-check-maven:update-only
  - ./mvnw --batch-mode -s .settings.xml -P security org.owasp:dependency-check-maven:check
  - ./mvnw --batch-mode -s .settings.xml package

before_deploy:
  - ./mvnw --batch-mode -s .settings.xml -P release clean package
  - ./mvnw versions:revert

deploy:
  provider: packagecloud
  username: ${PACKAGECLOUD_USER}
  token: ${PACKAGECLOUD_TOKEN}
  repository: "vikgru/account-tool"
  dist: "ubuntu/xenial"
  package_glob: "target/*.deb"
  on:
    branch: master
